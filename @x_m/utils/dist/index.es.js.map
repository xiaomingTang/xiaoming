{"version":3,"file":"index.es.js","sources":["../src/genePromiseOnce.ts","../src/sleepMs.ts"],"sourcesContent":["type PromisedFunc<T> = () => Promise<T>\n\n/**\n * 能缓存 promise, 确保 promise 在被多次调用时仅执行一次,\n * 其余的调用都会返回缓存的 promise;\n * promise resolved 之后, 继续调用会返回缓存的值(值不能是 undefined);\n * promise rejected 之后, 继续调用会重新执行 promise;\n * @param promise will be called only once forever, unless rejected\n * @example\n * ``` typescript\n * const promiseOnce = genePromiseOnce(expensiveButStorableAsyncFunction)\n *\n * window.addEventListener('resize', () => {\n *   promiseOnce()\n *     .then((res) => {\n *       console.log(`promise successed: ${res}`)\n *     })\n *     .catch(() => {\n *       console.log('catch')\n *     })\n * })\n * ```\n */\nexport function genePromiseOnce<T>(promise: PromisedFunc<T>): PromisedFunc<T> {\n  let cachedResult: T | undefined\n  let cachedPromise: Promise<T> | undefined\n\n  return async () => {\n    if (typeof cachedResult !== 'undefined') {\n      return cachedResult\n    }\n    if (cachedPromise) {\n      return cachedPromise\n    }\n    cachedPromise = promise()\n      .then((res) => {\n        cachedResult = res\n        return res\n      })\n      .finally(() => {\n        cachedPromise = undefined\n      })\n    return cachedPromise\n  }\n}\n","export function sleepMs(ms: number) {\n  return new Promise<void>((resolve) => {\n    setTimeout(resolve, ms)\n  })\n}\n"],"names":["genePromiseOnce","promise","cachedResult","cachedPromise","_asyncToGenerator","_regeneratorRuntime","_callee","_context","then","res","finally","sleepMs","ms","_Promise","resolve","setTimeout"],"mappings":";;;;;;AAuBO,SAASA,EAAmBC,GAA2C;AACxE,MAAAC,GACAC;AAEJ,SAAO,gBAAAC,EAAA,gBAAAC,EAAA,KAAA,SAAAC,IAAA;AAAA,WAAAD,EAAA,KAAA,SAAAE,GAAA;AAAA;AAAA,gBAAAA,EAAA,OAAAA,EAAA;AAAA,eAAA;AAAA,gBACD,OAAOL,KAAiB,aADvB;AAAA,cAAAK,EAAA,OAAA;AAAA;AAAA,YAAA;AAAA,mBAAAA,EAAA,OAAA,UAEIL,CAFJ;AAAA,eAAA;AAAA,gBAAA,CAIDC,GAJC;AAAA,cAAAI,EAAA,OAAA;AAAA;AAAA,YAAA;AAAA,mBAAAA,EAAA,OAAA,UAKIJ,CALJ;AAAA,eAAA;AAOLA,mBAAAA,IAAgBF,EAAQ,EACrBO,KAAK,SAACC,GAAQ;AACEP,qBAAAA,IAAAO,GACRA;AAAAA,aAHK,EAKbC,QAAQ,WAAM;AACGP,cAAAA,IAAA;AAAA,YACjB,CAPa,GAPXI,EAAA,OAAA,UAeEJ,CAfF;AAAA,eAAA;AAAA,eAAA;AAAA,mBAAAI,EAAA;;IAAA,GAAAD,CAAA;AAAA,EAAP,CAAA,CAAA;AAiBF;AC5CO,SAASK,EAAQC,GAAY;AAC3B,SAAA,IAAAC,EAAkB,SAACC,GAAY;AACpCC,eAAWD,GAASF,CAApB;AAAA,EACD,CAFM;AAGT;"}