{"version":3,"file":"index.umd.js","sources":["../src/genePromiseOnce.ts","../src/sleepMs.ts"],"sourcesContent":["type PromisedFunc<T> = () => Promise<T>\n\n/**\n * 能缓存 promise, 确保 promise 在被多次调用时仅执行一次,\n * 其余的调用都会返回缓存的 promise;\n * promise resolved 之后, 继续调用会返回缓存的值(值不能是 undefined);\n * promise rejected 之后, 继续调用会重新执行 promise;\n * @param promise will be called only once forever, unless rejected\n * @example\n * ``` typescript\n * const promiseOnce = genePromiseOnce(expensiveButStorableAsyncFunction)\n *\n * window.addEventListener('resize', () => {\n *   promiseOnce()\n *     .then((res) => {\n *       console.log(`promise successed: ${res}`)\n *     })\n *     .catch(() => {\n *       console.log('catch')\n *     })\n * })\n * ```\n */\nexport function genePromiseOnce<T>(promise: PromisedFunc<T>): PromisedFunc<T> {\n  let cachedResult: T | undefined\n  let cachedPromise: Promise<T> | undefined\n\n  return async () => {\n    if (typeof cachedResult !== 'undefined') {\n      return cachedResult\n    }\n    if (cachedPromise) {\n      return cachedPromise\n    }\n    cachedPromise = promise()\n      .then((res) => {\n        cachedResult = res\n        return res\n      })\n      .finally(() => {\n        cachedPromise = undefined\n      })\n    return cachedPromise\n  }\n}\n","export function sleepMs(ms: number) {\n  return new Promise<void>((resolve) => {\n    setTimeout(resolve, ms)\n  })\n}\n"],"names":["genePromiseOnce","promise","cachedResult","cachedPromise","_asyncToGenerator","_regeneratorRuntime","_callee","_context","then","res","finally","sleepMs","ms","_Promise","resolve","setTimeout"],"mappings":"27BAuBO,SAASA,EAAmBC,EAA2C,CACxE,IAAAC,EACAC,EAEJ,OAAOC,UAAAC,EAAAA,QAAA,KAAA,SAAAC,GAAA,CAAA,OAAAD,UAAA,KAAA,SAAAE,EAAA,CAAA,OAAA,OAAAA,EAAA,KAAAA,EAAA,UAAA,GAAA,GACD,OAAOL,GAAiB,YADvB,CAAAK,EAAA,KAAA,EAAA,KAAA,CAAA,OAAAA,EAAA,OAAA,SAEIL,CAFJ,MAAA,GAAA,GAAA,CAIDC,EAJC,CAAAI,EAAA,KAAA,EAAA,KAAA,CAAA,OAAAA,EAAA,OAAA,SAKIJ,CALJ,MAAA,GAOLA,OAAAA,EAAgBF,EAAQ,EACrBO,KAAK,SAACC,EAAQ,CACEP,OAAAA,EAAAO,EACRA,EAHK,EAKbC,QAAQ,UAAM,CACGP,EAAA,MACjB,CAPa,EAPXI,EAAA,OAAA,SAeEJ,CAfF,MAAA,OAAA,MAAA,OAAAI,EAAA,OAAA,EAAAD,CAAA,CAAP,CAAA,CAAA,CAiBF,CC5CO,SAASK,EAAQC,EAAY,CAC3B,OAAA,IAAAC,EAAAA,QAAkB,SAACC,EAAY,CACpCC,WAAWD,EAASF,CAApB,CACD,CAFM,CAGT"}